<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Christian ‚Äî 6th Grade Assignments (Canvas)</title>
  <meta name="description" content="Christian ‚Äî 6th Grade assignments auto-updated from Canvas calendar feed." />

  <style>
    /* ===== Base layout & type ===== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f1419 0%, #1a2332 50%, #0f1419 100%);
      background-image:
        radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 1px, transparent 1px),
        radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 1px, transparent 1px);
      background-size: 100px 100px;
      min-height: 100vh;
      padding: 20px;
      color: #e2e8f0;
      scroll-behavior: smooth;
    }
    .wrap { max-width: 1200px; margin: 0 auto; }

    /* ===== Header ===== */
    .header {
      background: linear-gradient(135deg, #1a365d 0%, #2c5282 50%, #1a202c 100%);
      border: 3px solid #4299e1;
      color: #e2e8f0;
      border-radius: 12px;
      padding: 24px 24px 18px;
      box-shadow:
        0 0 20px rgba(66, 153, 225, 0.3),
        inset 0 1px 0 rgba(255,255,255,0.1),
        0 12px 30px rgba(0,0,0,.4);
      margin-bottom: 18px;
      position: relative;
      overflow: hidden;
    }
    .header::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; height: 2px;
      background: linear-gradient(90deg, #4299e1, #63b3ed, #4299e1);
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:.5} 50%{opacity:1} }

    h1{
      font-size: clamp(22px, 3.2vw, 34px);
      font-weight: 900;
      letter-spacing: .2px;
      text-shadow: 0 0 10px rgba(66,153,225,.5);
    }
    .subtitle{opacity:.9;margin-top:6px;color:#cbd5e0}

    /* ===== Main container & KPIs ===== */
    .container{
      background: rgba(45,55,72,.95);
      border: 2px solid #4a5568;
      border-radius: 12px;
      box-shadow:
        0 20px 40px rgba(0,0,0,.4),
        inset 0 1px 0 rgba(255,255,255,.1);
      padding: 28px;
      backdrop-filter: blur(10px);
    }
    .summary{
      background: linear-gradient(135deg,#1a202c 0%,#2d3748 50%,#1a202c 100%);
      border: 2px solid #4299e1;
      color: #e2e8f0;
      padding: 16px 16px 8px;
      border-radius: 8px;
      margin-bottom: 22px;
      box-shadow:
        0 0 15px rgba(66,153,225,.2),
        inset 0 1px 0 rgba(255,255,255,.1);
    }
    /* auto-fit so tiles wrap nicely */
    .summary-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); gap:12px; }
    .stat{
      background: linear-gradient(135deg,#2d3748,#4a5568);
      border: 2px solid #718096;
      border-radius: 10px;
      padding: 14px 14px 12px;
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.1),
        inset 0 -2px 0 rgba(0,0,0,.2),
        0 4px 8px rgba(0,0,0,.3);
      position:relative;
      transition: transform .15s ease, box-shadow .15s ease;
      display: grid;
      grid-template-rows: auto auto;
      gap: 6px;
    }
    .num{ font-size:28px; font-weight:900; color:#e2e8f0; text-shadow:0 0 5px rgba(66,153,225,.3); }
    .lbl{ color:#a0aec0; font-size:14px; display:flex; align-items:center; gap:8px; }
    /* clickable KPI tiles */
    .clickable { cursor: pointer; }
    .clickable:focus, .clickable:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0,0,0,.35), inset 0 2px 0 rgba(255,255,255,.14);
      outline: none;
    }
    /* color swatches inside KPI labels */
    .swatch{
      width:12px; height:12px; border-radius:3px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.18);
      flex: 0 0 12px;
    }
    .sw-total{ background: linear-gradient(45deg,#718096,#a0aec0); }
    .sw-urgent{ background: linear-gradient(45deg,#e53e3e,#fc8181); }
    .sw-tomorrow{ background: linear-gradient(45deg,#dd6b20,#f6ad55); }
    .sw-past{ background: linear-gradient(45deg,#805ad5,#b794f6); }
    .sw-up{ background: linear-gradient(45deg,#3182ce,#63b3ed); }

    /* ===== Assignment grid & cards ===== */
    .assignments-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:18px; }
    .assignment-card{
      position:relative;
      background: linear-gradient(135deg,#2d3748 0%,#4a5568 100%);
      border: 2px solid transparent;
      border-radius: 8px;
      padding: 20px 20px 60px; /* reserve space for bottom-right badge */
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.1),
        inset 0 -2px 0 rgba(0,0,0,.2),
        0 8px 20px rgba(0,0,0,.4);
      transition: transform .2s ease, box-shadow .2s ease;
      overflow:hidden;
    }
    .assignment-card::before{
      content:''; position:absolute; top:6px; left:50%; transform:translateX(-50%);
      width:8px; height:8px; background:rgba(255,255,255,.2); border-radius:50%;
      box-shadow:-15px 0 rgba(255,255,255,.1), 15px 0 rgba(255,255,255,.1),
                 -30px 0 rgba(255,255,255,.05), 30px 0 rgba(255,255,255,.05);
    }
    .assignment-card:hover{
      transform:translateY(-4px);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.15),
        inset 0 -2px 0 rgba(0,0,0,.3),
        0 12px 30px rgba(0,0,0,.5);
    }

    .assignment-title{
      font-size:18px; font-weight:800; color:#e2e8f0; line-height:1.25;
      margin-bottom:8px; text-shadow: 0 1px 2px rgba(0,0,0,.3);
    }
    .course-info{ font-size:.95rem; color:#a0aec0; margin-bottom:12px; font-weight:600; }
    .due-date{ display:flex; align-items:center; gap:8px; font-weight:700; margin-bottom:16px; color:#cbd5e0; }
    .due-date-icon{ width:16px; height:16px; }

    /* ===== Status badge ‚Äî bottom-right ===== */
    .status-badge{
      position:absolute; bottom:12px; right:12px;
      padding:6px 12px; border-radius:4px;
      font-size:10px; font-weight:800; color:#1a202c;
      text-transform:uppercase; letter-spacing:.5px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 2px 4px rgba(0,0,0,.3);
    }

    /* ===== Status themes ===== */
    .urgent{
      border-color:#e53e3e;
      background: linear-gradient(135deg,#742a2a 0%,#9c4221 100%);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.1),
        inset 0 -2px 0 rgba(0,0,0,.2),
        0 0 15px rgba(229,62,62,.3),
        0 8px 20px rgba(0,0,0,.4);
    }
    .urgent .due-date{ color:#fc8181; text-shadow:0 0 5px rgba(229,62,62,.5); }
    .urgent .status-badge{ background:linear-gradient(45deg,#e53e3e,#fc8181); }

    .no-due{
      border-color:#4299e1;
      background: linear-gradient(135deg,#2c5282 0%,#3182ce 100%);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.1),
        inset 0 -2px 0 rgba(0,0,0,.2),
        0 0 15px rgba(66,153,225,.3),
        0 8px 20px rgba(0,0,0,.4);
    }
    .no-due .due-date{ color:#63b3ed; text-shadow:0 0 5px rgba(66,153,225,.5); }
    .no-due .status-badge{ background:linear-gradient(45deg,#4299e1,#63b3ed); }

    .past-due{
      border-color:#805ad5;
      background: linear-gradient(135deg,#553c9a 0%,#6b46c1 100%);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.1),
        inset 0 -2px 0 rgba(0,0,0,.2),
        0 0 15px rgba(128,90,213,.3),
        0 8px 20px rgba(0,0,0,.4);
    }
    .past-due .due-date{ color:#b794f6; text-shadow:0 0 5px rgba(128,90,213,.5); }
    .past-due .status-badge{ background:linear-gradient(45deg,#805ad5,#b794f6); }

    /* ‚ÄúUpcoming‚Äù (future due dates after tomorrow) */
    .todo{
      border-color:#3182ce;
      background: linear-gradient(135deg,#2a4365 0%,#3182ce 100%);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.1),
        inset 0 -2px 0 rgba(0,0,0,.2),
        0 0 15px rgba(49,130,206,.3),
        0 8px 20px rgba(0,0,0,.4);
    }
    .todo .due-date{ color:#63b3ed; text-shadow:0 0 5px rgba(49,130,206,.5); }
    .todo .status-badge{ background:linear-gradient(45deg,#3182ce,#63b3ed); }

    /* ‚ÄúTomorrow‚Äù theme */
    .tomorrow{
      border-color:#dd6b20;
      background: linear-gradient(135deg, #8b5a18 0%, #b7791f 60%, #dd6b20 100%);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.1),
        inset 0 -2px 0 rgba(0,0,0,.2),
        0 0 15px rgba(221,107,32,.28),
        0 8px 20px rgba(0,0,0,.4);
    }
    .tomorrow .due-date{ color:#f6ad55; text-shadow:0 0 5px rgba(221,107,32,.5); }
    .tomorrow .status-badge{ background: linear-gradient(45deg,#dd6b20,#f6ad55); }

    /* Section title */
    .section-title{
      margin: 10px 4px 12px;
      font-weight: 900;
      letter-spacing: .3px;
      color: #e2e8f0;
    }

    /* Small screens */
    @media (max-width: 860px){
      .container{ padding:20px; }
    }
    @media (max-width: 480px){
      .assignment-card{ padding-bottom:72px; }
    }

    /* Loading animation */
    .loading{
      display:inline-block; width:20px; height:20px;
      border:2px solid #4a5568; border-radius:50%;
      border-top-color:#4299e1; animation:spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg); } }

    /* flash highlight after KPI jump */
    @keyframes flash {
      0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.0), 0 0 0 rgba(66,153,225,0); }
      30% { box-shadow: 0 0 0 6px rgba(66,153,225,0.35); }
      100% { box-shadow: 0 0 0 0 rgba(66,153,225,0); }
    }
    .flash { animation: flash 1.2s ease-out 1; }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- Header -->
    <header class="header">
      <h1>üöÄ Christian ‚Äî Jedi Academy Assignments</h1>
      <p class="subtitle">Mission Control for your Canvas assignments. May the Force be with your studies!</p>
      <!-- Legend chips removed per your request -->
    </header>

    <!-- Main -->
    <main class="container">
      <!-- KPI Summary (only clickable tiles with color squares) -->
      <section class="summary" aria-label="Mission Summary">
        <div class="summary-grid">
          <div class="stat clickable" id="tile-total" aria-label="Jump to top" tabindex="0">
            <div class="num" id="kpi-total">‚Äî</div>
            <div class="lbl"><span class="swatch sw-total" aria-hidden="true"></span> Total Missions</div>
          </div>
          <div class="stat clickable" id="tile-today" aria-label="Jump to first Due Today" tabindex="0">
            <div class="num" id="kpi-today">‚Äî</div>
            <div class="lbl"><span class="swatch sw-urgent" aria-hidden="true"></span> Urgent Today</div>
          </div>
          <div class="stat clickable" id="tile-tomorrow" aria-label="Jump to first Due Tomorrow" tabindex="0">
            <div class="num" id="kpi-tomorrow">‚Äî</div>
            <div class="lbl"><span class="swatch sw-tomorrow" aria-hidden="true"></span> Due Tomorrow</div>
          </div>
          <div class="stat clickable" id="tile-pastdue" aria-label="Jump to first Past Due" tabindex="0">
            <div class="num" id="kpi-pastdue">‚Äî</div>
            <div class="lbl"><span class="swatch sw-past" aria-hidden="true"></span> Past Due</div>
          </div>
          <div class="stat clickable" id="tile-upcoming" aria-label="Jump to first Upcoming" tabindex="0">
            <div class="num" id="kpi-upcoming">‚Äî</div>
            <div class="lbl"><span class="swatch sw-up" aria-hidden="true"></span> Upcoming</div>
          </div>
        </div>
      </section>

      <!-- Cards go here -->
      <h2 class="section-title" id="tomorrow-title">Due Tomorrow</h2>
      <section class="assignments-grid" id="grid-tomorrow"></section>

      <section class="assignments-grid" id="grid">
        <p style="color:#a0aec0; display:flex; align-items:center; gap:10px;">
          <span class="loading"></span>
          Loading your missions from the Academy...
        </p>
      </section>
    </main>
  </div>

  <script>
  (async () => {
    const grid = document.getElementById('grid');
    const gridTomorrow = document.getElementById('grid-tomorrow');
    const tomorrowTitle = document.getElementById('tomorrow-title');
    const set = (id, v) => { const el = document.getElementById(id); if (el) el.textContent = v; };

    // Day windows (local time)
    const startToday = new Date(); startToday.setHours(0,0,0,0);
    const startTomorrow = new Date(startToday); startTomorrow.setDate(startTomorrow.getDate() + 1);
    const startDayAfterTomorrow = new Date(startTomorrow); startDayAfterTomorrow.setDate(startDayAfterTomorrow.getDate() + 1);

    const hasDue = (i) => !!i.due_at;
    const dueDate = (i) => new Date(i.due_at);

    const isToday    = (i) => hasDue(i) && dueDate(i) >= startToday && dueDate(i) < startTomorrow;
    const isTomorrow = (i) => hasDue(i) && dueDate(i) >= startTomorrow && dueDate(i) < startDayAfterTomorrow;
    const isPastDue  = (i) => hasDue(i) && dueDate(i) < startToday;
    const isUpcoming = (i) => hasDue(i) && dueDate(i) >= startDayAfterTomorrow; // strictly after tomorrow

    const bucketFor = (i) => {
      if (isToday(i)) return 'urgent';
      if (isTomorrow(i)) return 'tomorrow';
      if (isPastDue(i)) return 'past-due';
      if (isUpcoming(i)) return 'todo';     // "Upcoming" uses .todo class
      return 'no-due';
    };

    const badgeFor = (bucket) => ({
      'urgent':   'Due Today',
      'tomorrow': 'Due Tomorrow',
      'past-due': 'Past Due',
      'todo':     'Upcoming',
      'no-due':   'No Due Date',
      'completed':'Completed'
    }[bucket] || 'Upcoming');

    const dateRow = (iso) => {
      const txt = iso ? new Date(iso).toLocaleString() : 'No Due Date';
      return `
        <div class="due-date">
          <svg class="due-date-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
          </svg>
          ${txt}
        </div>`;
    };

    // Render a single card
    const renderCard = (i, forcedBucket=null) => {
      const bucket = forcedBucket || bucketFor(i);
      return `
        <article class="assignment-card ${bucket}">
          <div class="status-badge">${badgeFor(bucket)}</div>
          <div class="assignment-title">${i.title}</div>
          <div class="course-info">${i.course || ''}</div>
          ${dateRow(i.due_at)}
        </article>`;
    };

    // Load data
    let items = [];
    try {
      const res = await fetch('./assignments.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('No assignments.json yet');
      items = await res.json();
    } catch (e) {
      if (gridTomorrow) { gridTomorrow.innerHTML = ''; tomorrowTitle && (tomorrowTitle.style.display='none'); }
      grid.innerHTML = '<p style="color:#fc8181; display:flex; align-items:center; gap:10px;"><span class="loading"></span>assignments.json not found yet ‚Äî the sync will create it shortly.</p>';
      console.error(e);
      return;
    }

    // KPIs computed from dates
    const listToday     = items.filter(isToday);
    const listTomorrow  = items.filter(isTomorrow);
    const listPastDue   = items.filter(isPastDue);
    const listUpcoming  = items.filter(isUpcoming);

    set('kpi-total', items.length);
    set('kpi-today', listToday.length);
    set('kpi-tomorrow', listTomorrow.length);
    set('kpi-pastdue', listPastDue.length);
    set('kpi-upcoming', listUpcoming.length);

    // Tomorrow section
    if (listTomorrow.length) {
      gridTomorrow.innerHTML = listTomorrow.map(i => renderCard(i, 'tomorrow')).join('');
      tomorrowTitle.style.display = '';
    } else {
      gridTomorrow.innerHTML = '';
      tomorrowTitle.style.display = 'none';
    }

    // Main grid: everything else (not tomorrow)
    const others = items.filter(i => !isTomorrow(i));
    grid.innerHTML = others.map(i => renderCard(i)).join('');

    // ===== KPI tile click handlers: jump to first card in bucket and flash =====
    const scrollToFirst = (selector, fallbackId) => {
      const el = document.querySelector(selector) || document.getElementById(fallbackId);
      if (!el) return;
      let card = el.matches('.assignment-card') ? el : el.querySelector('.assignment-card');
      (card || el).scrollIntoView({ behavior: 'smooth', block: 'start' });
      if (card) {
        card.classList.add('flash');
        setTimeout(() => card.classList.remove('flash'), 1400);
      }
    };

    const bindJump = (tileId, querySelector, fallbackId) => {
      const t = document.getElementById(tileId);
      if (!t) return;
      const handler = () => scrollToFirst(querySelector, fallbackId);
      t.addEventListener('click', handler);
      t.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handler(); }
      });
    };

    bindJump('tile-today',     '#grid .assignment-card.urgent',   'grid');
    bindJump('tile-tomorrow',  '#grid-tomorrow .assignment-card', 'grid-tomorrow');
    bindJump('tile-pastdue',   '#grid .assignment-card.past-due', 'grid');
    bindJump('tile-upcoming',  '#grid .assignment-card.todo',     'grid');

    // tile-total -> scroll to top
    const tileTotal = document.getElementById('tile-total');
    if (tileTotal) {
      const handler = () => window.scrollTo({ top: 0, behavior: 'smooth' });
      tileTotal.addEventListener('click', handler);
      tileTotal.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handler(); }
      });
    }
  })();
  </script>
</body>
</html>
